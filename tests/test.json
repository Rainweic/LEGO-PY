{
    "cells": [
        {
            "shape": "dag-edge",
            "attrs": {
                "line": {
                    "strokeDasharray": 0,
                    "style": {
                        "animation": ""
                    }
                }
            },
            "zIndex": -1,
            "id": "28c876bb-3161-4a9f-8ca6-440a054be6be",
            "animated": false,
            "source": {
                "cell": "d612c7c6-8f8a-45eb-9ac7-41635d54af3e",
                "port": "o-0"
            },
            "target": {
                "cell": "5550e17f-0e1b-4164-8074-c32ffe201152",
                "port": "i-0"
            }
        },
        {
            "shape": "dag-edge",
            "attrs": {
                "line": {
                    "strokeDasharray": 0,
                    "style": {
                        "animation": ""
                    }
                }
            },
            "zIndex": -1,
            "id": "6118978c-d77d-4ee7-b95d-c816fb9d013b",
            "animated": false,
            "source": {
                "cell": "5550e17f-0e1b-4164-8074-c32ffe201152",
                "port": "o-0"
            },
            "target": {
                "cell": "ff4f36bf-1fe4-4e2e-80f7-7320d1eb710b"
            }
        },
        {
            "shape": "dag-edge",
            "attrs": {
                "line": {
                    "strokeDasharray": 0,
                    "style": {
                        "animation": ""
                    }
                }
            },
            "zIndex": -1,
            "id": "64bb0faa-8b7e-423e-b18d-013437d0d328",
            "animated": false,
            "source": {
                "cell": "ff4f36bf-1fe4-4e2e-80f7-7320d1eb710b",
                "port": "o-0"
            },
            "target": {
                "cell": "3c08ea37-03fd-465f-a68a-a212838449c4",
                "port": "i-0"
            }
        },
        {
            "shape": "dag-edge",
            "attrs": {
                "line": {
                    "strokeDasharray": 0,
                    "style": {
                        "animation": ""
                    }
                }
            },
            "zIndex": -1,
            "id": "26f3d350-dce3-447f-ad7b-111e774fa866",
            "animated": false,
            "source": {
                "cell": "3c08ea37-03fd-465f-a68a-a212838449c4",
                "port": "o-0"
            },
            "target": {
                "cell": "e2101b1a-e1a3-4832-bf8f-475761aeedcc",
                "port": "i-0"
            }
        },
        {
            "position": {
                "x": 240,
                "y": 80
            },
            "size": {
                "width": 180,
                "height": 36
            },
            "view": "react-shape-view",
            "shape": "dag-node",
            "ports": {
                "groups": {
                    "inputData": {
                        "position": "top",
                        "attrs": {
                            "circle": {
                                "r": 4,
                                "magnet": true,
                                "stroke": "#C2C8D5",
                                "strokeWidth": 1,
                                "fill": "#fff"
                            }
                        }
                    },
                    "outputData": {
                        "position": "bottom",
                        "attrs": {
                            "circle": {
                                "r": 4,
                                "magnet": true,
                                "stroke": "#C2C8D5",
                                "strokeWidth": 1,
                                "fill": "#fff"
                            }
                        }
                    },
                    "outputModel": {
                        "position": "bottom",
                        "attrs": {
                            "circle": {
                                "r": 4,
                                "magnet": true,
                                "stroke": "#C2C8D5",
                                "strokeWidth": 1,
                                "fill": "#fff"
                            }
                        }
                    }
                },
                "items": [
                    {
                        "id": "o-0",
                        "group": "outputData"
                    }
                ]
            },
            "id": "d612c7c6-8f8a-45eb-9ac7-41635d54af3e",
            "data": {
                "key": "HDFSCSVReadStage",
                "label": "label读取",
                "status": "default",
                "id": "d612c7c6-8f8a-45eb-9ac7-41635d54af3e",
                "collect": true,
                "args": {
                    "path": "/projects/growth/test/analysis_tools/alg_label/coupon_planned_strategy/expose_label/single/2024-09-05"
                }
            },
            "zIndex": 1
        },
        {
            "position": {
                "x": 240,
                "y": 140
            },
            "size": {
                "width": 180,
                "height": 36
            },
            "view": "react-shape-view",
            "shape": "dag-node",
            "ports": {
                "groups": {
                    "inputData": {
                        "position": "top",
                        "attrs": {
                            "circle": {
                                "r": 4,
                                "magnet": true,
                                "stroke": "#C2C8D5",
                                "strokeWidth": 1,
                                "fill": "#fff"
                            }
                        }
                    },
                    "outputData": {
                        "position": "bottom",
                        "attrs": {
                            "circle": {
                                "r": 4,
                                "magnet": true,
                                "stroke": "#C2C8D5",
                                "strokeWidth": 1,
                                "fill": "#fff"
                            }
                        }
                    },
                    "outputModel": {
                        "position": "bottom",
                        "attrs": {
                            "circle": {
                                "r": 4,
                                "magnet": true,
                                "stroke": "#C2C8D5",
                                "strokeWidth": 1,
                                "fill": "#fff"
                            }
                        }
                    }
                },
                "items": [
                    {
                        "id": "i-0",
                        "group": "inputData"
                    },
                    {
                        "id": "o-0",
                        "group": "outputData"
                    }
                ]
            },
            "id": "5550e17f-0e1b-4164-8074-c32ffe201152",
            "data": {
                "key": "CastStage",
                "label": "自定义映射",
                "status": "default",
                "id": "5550e17f-0e1b-4164-8074-c32ffe201152",
                "collect": true,
                "args": {
                    "col_name": "label_value",
                    "map": "{1:0, 2:0, 0:1, -1:-1}",
                    "recover_ori_col": true
                }
            },
            "zIndex": 2
        },
        {
            "position": {
                "x": 240,
                "y": 200
            },
            "size": {
                "width": 180,
                "height": 36
            },
            "view": "react-shape-view",
            "shape": "dag-node",
            "ports": {
                "groups": {
                    "inputData": {
                        "position": "top",
                        "attrs": {
                            "circle": {
                                "r": 4,
                                "magnet": true,
                                "stroke": "#C2C8D5",
                                "strokeWidth": 1,
                                "fill": "#fff"
                            }
                        }
                    },
                    "outputData": {
                        "position": "bottom",
                        "attrs": {
                            "circle": {
                                "r": 4,
                                "magnet": true,
                                "stroke": "#C2C8D5",
                                "strokeWidth": 1,
                                "fill": "#fff"
                            }
                        }
                    },
                    "outputModel": {
                        "position": "bottom",
                        "attrs": {
                            "circle": {
                                "r": 4,
                                "magnet": true,
                                "stroke": "#C2C8D5",
                                "strokeWidth": 1,
                                "fill": "#fff"
                            }
                        }
                    }
                },
                "items": [
                    {
                        "id": "i-0",
                        "group": "inputData"
                    },
                    {
                        "id": "o-0",
                        "group": "outputData"
                    }
                ]
            },
            "id": "ff4f36bf-1fe4-4e2e-80f7-7320d1eb710b",
            "data": {
                "args": {
                    "conditions": [
                        "label_value!= -1",
                        "position_id == 'W101'"
                    ]
                },
                "key": "Where",
                "label": "过滤",
                "status": "default",
                "id": "ff4f36bf-1fe4-4e2e-80f7-7320d1eb710b",
                "collect": true
            },
            "zIndex": 3
        },
        {
            "position": {
                "x": 240,
                "y": 260
            },
            "size": {
                "width": 180,
                "height": 36
            },
            "view": "react-shape-view",
            "shape": "dag-node",
            "ports": {
                "groups": {
                    "inputData": {
                        "position": "top",
                        "attrs": {
                            "circle": {
                                "r": 4,
                                "magnet": true,
                                "stroke": "#C2C8D5",
                                "strokeWidth": 1,
                                "fill": "#fff"
                            }
                        }
                    },
                    "outputData": {
                        "position": "bottom",
                        "attrs": {
                            "circle": {
                                "r": 4,
                                "magnet": true,
                                "stroke": "#C2C8D5",
                                "strokeWidth": 1,
                                "fill": "#fff"
                            }
                        }
                    },
                    "outputModel": {
                        "position": "bottom",
                        "attrs": {
                            "circle": {
                                "r": 4,
                                "magnet": true,
                                "stroke": "#C2C8D5",
                                "strokeWidth": 1,
                                "fill": "#fff"
                            }
                        }
                    }
                },
                "items": [
                    {
                        "id": "i-0",
                        "group": "inputData"
                    },
                    {
                        "id": "o-0",
                        "group": "outputData"
                    }
                ]
            },
            "id": "3c08ea37-03fd-465f-a68a-a212838449c4",
            "data": {
                "args": {
                    "cols": [
                        "member_id",
                        "label_value",
                        "dt"
                    ]
                },
                "key": "SelectCols",
                "label": "特征选择-4",
                "status": "default",
                "id": "3c08ea37-03fd-465f-a68a-a212838449c4",
                "collect": true
            },
            "zIndex": 4
        },
        {
            "position": {
                "x": 240,
                "y": 320
            },
            "size": {
                "width": 180,
                "height": 36
            },
            "view": "react-shape-view",
            "shape": "dag-node",
            "ports": {
                "groups": {
                    "inputData": {
                        "position": "top",
                        "attrs": {
                            "circle": {
                                "r": 4,
                                "magnet": true,
                                "stroke": "#C2C8D5",
                                "strokeWidth": 1,
                                "fill": "#fff"
                            }
                        }
                    },
                    "outputData": {
                        "position": "bottom",
                        "attrs": {
                            "circle": {
                                "r": 4,
                                "magnet": true,
                                "stroke": "#C2C8D5",
                                "strokeWidth": 1,
                                "fill": "#fff"
                            }
                        }
                    },
                    "outputModel": {
                        "position": "bottom",
                        "attrs": {
                            "circle": {
                                "r": 4,
                                "magnet": true,
                                "stroke": "#C2C8D5",
                                "strokeWidth": 1,
                                "fill": "#fff"
                            }
                        }
                    }
                },
                "items": [
                    {
                        "id": "i-0",
                        "group": "inputData"
                    },
                    {
                        "id": "o-0",
                        "group": "outputData"
                    }
                ]
            },
            "id": "e2101b1a-e1a3-4832-bf8f-475761aeedcc",
            "data": {
                "args": {
                    "sql_str": "WITH sample_counts AS (\n    SELECT \n        SUM(CASE WHEN label_value = 1 THEN 1 ELSE 0 END) AS positive_count,\n        SUM(CASE WHEN label_value = 0 THEN 1 ELSE 0 END) AS negative_count,\n        {n_all_samples} // 2 AS target_sample_count\n),\nsample_size AS (\n    SELECT LEAST(positive_count, negative_count, target_sample_count) AS n_samples\n    FROM sample_counts\n)\n\nSELECT *\nFROM (\n    (SELECT * \n        FROM self \n        WHERE label_value = 1\n        ORDER BY RANDOM()\n        LIMIT (SELECT n_samples FROM sample_size))\n    \n    UNION ALL\n    \n    (SELECT * \n        FROM self \n        WHERE label_value = 0\n        ORDER BY RANDOM()\n        LIMIT (SELECT n_samples FROM sample_size))\n)"
                },
                "key": "SqlStage",
                "label": "正负样本均衡",
                "status": "default",
                "id": "e2101b1a-e1a3-4832-bf8f-475761aeedcc",
                "collect": true
            },
            "zIndex": 5
        }
    ]
}